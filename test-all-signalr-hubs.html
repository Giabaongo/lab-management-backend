<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignalR Hubs Testing - All Hubs</title>
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.0/dist/browser/signalr.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .hubs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .hub-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .hub-card h2 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .status.connected {
            background: #10b981;
            color: white;
        }
        
        .status.disconnected {
            background: #ef4444;
            color: white;
        }
        
        .status.connecting {
            background: #f59e0b;
            color: white;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #374151;
            font-weight: 600;
        }
        
        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-connect {
            background: #10b981;
            color: white;
        }
        
        .btn-disconnect {
            background: #ef4444;
            color: white;
        }
        
        .btn-join {
            background: #3b82f6;
            color: white;
        }
        
        .btn-leave {
            background: #f59e0b;
            color: white;
        }
        
        .log-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .log-section h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .log-container {
            background: #1f2937;
            border-radius: 8px;
            padding: 15px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .log-entry.info { background: #1e40af; color: #93c5fd; }
        .log-entry.success { background: #065f46; color: #6ee7b7; }
        .log-entry.error { background: #7f1d1d; color: #fca5a5; }
        .log-entry.event { background: #581c87; color: #d8b4fe; }
        .log-entry.warning { background: #78350f; color: #fcd34d; }
        
        .timestamp {
            color: #9ca3af;
            margin-right: 10px;
        }
        
        .clear-log {
            background: #6b7280;
            color: white;
            margin-bottom: 10px;
        }
        
        .test-all-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            font-size: 16px;
            margin-bottom: 20px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ SignalR Hubs Testing Dashboard</h1>
        
        <button class="test-all-btn" onclick="testAllHubs()">üß™ Test All Hubs Automatically</button>
        
        <div class="hubs-grid">
            <!-- Booking Hub -->
            <div class="hub-card">
                <h2>üìÖ Booking Hub</h2>
                <span id="booking-status" class="status disconnected">Disconnected</span>
                
                <div class="control-group">
                    <label>Manager ID:</label>
                    <input type="number" id="booking-manager-id" value="3" min="1">
                </div>
                
                <div class="button-group">
                    <button class="btn-connect" onclick="connectBooking()">Connect</button>
                    <button class="btn-disconnect" onclick="disconnectBooking()">Disconnect</button>
                    <button class="btn-join" onclick="joinBookingManager()">Join Group</button>
                    <button class="btn-leave" onclick="leaveBookingManager()">Leave Group</button>
                </div>
            </div>
            
            <!-- Equipment Hub -->
            <div class="hub-card">
                <h2>üîß Equipment Hub</h2>
                <span id="equipment-status" class="status disconnected">Disconnected</span>
                
                <div class="control-group">
                    <label>Lab ID:</label>
                    <input type="number" id="equipment-lab-id" value="1" min="1">
                </div>
                
                <div class="button-group">
                    <button class="btn-connect" onclick="connectEquipment()">Connect</button>
                    <button class="btn-disconnect" onclick="disconnectEquipment()">Disconnect</button>
                    <button class="btn-join" onclick="joinAllManagers()">Join All Managers</button>
                    <button class="btn-join" onclick="joinLabGroup()">Join Lab Group</button>
                </div>
            </div>
            
            <!-- Security Log Hub -->
            <div class="hub-card">
                <h2>üîí Security Log Hub</h2>
                <span id="security-status" class="status disconnected">Disconnected</span>
                
                <div class="control-group">
                    <label>Lab ID:</label>
                    <input type="number" id="security-lab-id" value="1" min="1">
                </div>
                
                <div class="button-group">
                    <button class="btn-connect" onclick="connectSecurity()">Connect</button>
                    <button class="btn-disconnect" onclick="disconnectSecurity()">Disconnect</button>
                    <button class="btn-join" onclick="joinSecurityTeam()">Join Security Team</button>
                    <button class="btn-join" onclick="joinLabSecurity()">Join Lab Security</button>
                </div>
            </div>
            
            <!-- Lab Event Hub -->
            <div class="hub-card">
                <h2>üéØ Lab Event Hub</h2>
                <span id="labevent-status" class="status disconnected">Disconnected</span>
                
                <div class="control-group">
                    <label>Lab ID:</label>
                    <input type="number" id="labevent-lab-id" value="1" min="1">
                </div>
                
                <div class="control-group">
                    <label>Event ID:</label>
                    <input type="number" id="labevent-event-id" value="1" min="1">
                </div>
                
                <div class="button-group">
                    <button class="btn-connect" onclick="connectLabEvent()">Connect</button>
                    <button class="btn-disconnect" onclick="disconnectLabEvent()">Disconnect</button>
                    <button class="btn-join" onclick="joinAllEvents()">Join All Events</button>
                    <button class="btn-join" onclick="subscribeToEvent()">Subscribe Event</button>
                </div>
            </div>
            
            <!-- Notification Hub -->
            <div class="hub-card">
                <h2>üîî Notification Hub</h2>
                <span id="notification-status" class="status disconnected">Disconnected</span>
                
                <div class="control-group">
                    <label>User ID:</label>
                    <input type="number" id="notification-user-id" value="1" min="1">
                </div>
                
                <div class="control-group">
                    <label>Role:</label>
                    <input type="text" id="notification-role" value="Manager">
                </div>
                
                <div class="button-group">
                    <button class="btn-connect" onclick="connectNotification()">Connect</button>
                    <button class="btn-disconnect" onclick="disconnectNotification()">Disconnect</button>
                    <button class="btn-join" onclick="joinUserGroup()">Join User Group</button>
                    <button class="btn-join" onclick="joinRoleGroup()">Join Role Group</button>
                </div>
            </div>
        </div>
        
        <div class="log-section">
            <h2>üìù Event Log</h2>
            <button class="clear-log" onclick="clearLog()">Clear Log</button>
            <div class="log-container" id="log-container"></div>
        </div>
    </div>

    <script>
        let bookingConnection = null;
        let equipmentConnection = null;
        let securityConnection = null;
        let labEventConnection = null;
        let notificationConnection = null;
        
        const apiUrl = 'http://localhost:5162';
        
        function log(message, type = 'info') {
            const container = document.getElementById('log-container');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            entry.innerHTML = `<span class="timestamp">[${timestamp}]</span>${message}`;
            
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log-container').innerHTML = '';
            log('Log cleared', 'info');
        }
        
        function updateStatus(hubName, status) {
            const element = document.getElementById(`${hubName}-status`);
            element.className = `status ${status}`;
            element.textContent = status.charAt(0).toUpperCase() + status.slice(1);
        }
        
        // ============ BOOKING HUB ============
        async function connectBooking() {
            try {
                updateStatus('booking', 'connecting');
                log('üîÑ Connecting to Booking Hub...', 'info');
                
                bookingConnection = new signalR.HubConnectionBuilder()
                    .withUrl(`${apiUrl}/hubs/booking`)
                    .configureLogging(signalR.LogLevel.Debug)
                    .build();
                
                bookingConnection.on('BookingCreated', (data) => {
                    log(`üéâ Booking Created Event: ${JSON.stringify(data)}`, 'event');
                });
                
                bookingConnection.onclose((error) => {
                    updateStatus('booking', 'disconnected');
                    log('‚ùå Booking Hub disconnected: ' + (error || 'No error'), 'error');
                });
                
                await bookingConnection.start();
                updateStatus('booking', 'connected');
                log('‚úÖ Booking Hub connected successfully!', 'success');
            } catch (error) {
                updateStatus('booking', 'disconnected');
                log('‚ùå Booking Hub connection failed: ' + error.message, 'error');
            }
        }
        
        async function disconnectBooking() {
            if (bookingConnection) {
                await bookingConnection.stop();
                updateStatus('booking', 'disconnected');
                log('üîå Booking Hub disconnected', 'info');
            }
        }
        
        async function joinBookingManager() {
            if (!bookingConnection || bookingConnection.state !== 'Connected') {
                log('‚ö†Ô∏è Booking Hub not connected', 'warning');
                return;
            }
            
            const managerId = parseInt(document.getElementById('booking-manager-id').value);
            try {
                await bookingConnection.invoke('JoinManagerGroup', managerId);
                log(`‚úÖ Joined manager group: ${managerId}`, 'success');
            } catch (error) {
                log(`‚ùå Failed to join manager group: ${error.message}`, 'error');
            }
        }
        
        async function leaveBookingManager() {
            if (!bookingConnection || bookingConnection.state !== 'Connected') {
                log('‚ö†Ô∏è Booking Hub not connected', 'warning');
                return;
            }
            
            const managerId = parseInt(document.getElementById('booking-manager-id').value);
            try {
                await bookingConnection.invoke('LeaveManagerGroup', managerId);
                log(`‚úÖ Left manager group: ${managerId}`, 'success');
            } catch (error) {
                log(`‚ùå Failed to leave manager group: ${error.message}`, 'error');
            }
        }
        
        // ============ EQUIPMENT HUB ============
        async function connectEquipment() {
            try {
                updateStatus('equipment', 'connecting');
                log('üîÑ Connecting to Equipment Hub...', 'info');
                
                equipmentConnection = new signalR.HubConnectionBuilder()
                    .withUrl(`${apiUrl}/hubs/equipment`)
                    .configureLogging(signalR.LogLevel.Debug)
                    .build();
                
                equipmentConnection.on('EquipmentStatusChanged', (data) => {
                    log(`üîß Equipment Status Changed: ${JSON.stringify(data)}`, 'event');
                });
                
                equipmentConnection.onclose((error) => {
                    updateStatus('equipment', 'disconnected');
                    log('‚ùå Equipment Hub disconnected: ' + (error || 'No error'), 'error');
                });
                
                await equipmentConnection.start();
                updateStatus('equipment', 'connected');
                log('‚úÖ Equipment Hub connected successfully!', 'success');
            } catch (error) {
                updateStatus('equipment', 'disconnected');
                log('‚ùå Equipment Hub connection failed: ' + error.message, 'error');
            }
        }
        
        async function disconnectEquipment() {
            if (equipmentConnection) {
                await equipmentConnection.stop();
                updateStatus('equipment', 'disconnected');
                log('üîå Equipment Hub disconnected', 'info');
            }
        }
        
        async function joinAllManagers() {
            if (!equipmentConnection || equipmentConnection.state !== 'Connected') {
                log('‚ö†Ô∏è Equipment Hub not connected', 'warning');
                return;
            }
            
            try {
                await equipmentConnection.invoke('JoinAllManagersGroup');
                log('‚úÖ Joined all managers group', 'success');
            } catch (error) {
                log(`‚ùå Failed to join all managers: ${error.message}`, 'error');
            }
        }
        
        async function joinLabGroup() {
            if (!equipmentConnection || equipmentConnection.state !== 'Connected') {
                log('‚ö†Ô∏è Equipment Hub not connected', 'warning');
                return;
            }
            
            const labId = parseInt(document.getElementById('equipment-lab-id').value);
            try {
                await equipmentConnection.invoke('JoinLabGroup', labId);
                log(`‚úÖ Joined lab group: ${labId}`, 'success');
            } catch (error) {
                log(`‚ùå Failed to join lab group: ${error.message}`, 'error');
            }
        }
        
        // ============ SECURITY LOG HUB ============
        async function connectSecurity() {
            try {
                updateStatus('security', 'connecting');
                log('üîÑ Connecting to Security Hub...', 'info');
                
                securityConnection = new signalR.HubConnectionBuilder()
                    .withUrl(`${apiUrl}/hubs/security`)
                    .configureLogging(signalR.LogLevel.Debug)
                    .build();
                
                securityConnection.on('SecurityAlert', (data) => {
                    log(`üîí Security Alert: ${JSON.stringify(data)}`, 'event');
                });
                
                securityConnection.onclose((error) => {
                    updateStatus('security', 'disconnected');
                    log('‚ùå Security Hub disconnected: ' + (error || 'No error'), 'error');
                });
                
                await securityConnection.start();
                updateStatus('security', 'connected');
                log('‚úÖ Security Hub connected successfully!', 'success');
            } catch (error) {
                updateStatus('security', 'disconnected');
                log('‚ùå Security Hub connection failed: ' + error.message, 'error');
            }
        }
        
        async function disconnectSecurity() {
            if (securityConnection) {
                await securityConnection.stop();
                updateStatus('security', 'disconnected');
                log('üîå Security Hub disconnected', 'info');
            }
        }
        
        async function joinSecurityTeam() {
            if (!securityConnection || securityConnection.state !== 'Connected') {
                log('‚ö†Ô∏è Security Hub not connected', 'warning');
                return;
            }
            
            try {
                await securityConnection.invoke('JoinSecurityTeamGroup');
                log('‚úÖ Joined security team group', 'success');
            } catch (error) {
                log(`‚ùå Failed to join security team: ${error.message}`, 'error');
            }
        }
        
        async function joinLabSecurity() {
            if (!securityConnection || securityConnection.state !== 'Connected') {
                log('‚ö†Ô∏è Security Hub not connected', 'warning');
                return;
            }
            
            const labId = parseInt(document.getElementById('security-lab-id').value);
            try {
                await securityConnection.invoke('JoinLabSecurityGroup', labId);
                log(`‚úÖ Joined lab security group: ${labId}`, 'success');
            } catch (error) {
                log(`‚ùå Failed to join lab security: ${error.message}`, 'error');
            }
        }
        
        // ============ LAB EVENT HUB ============
        async function connectLabEvent() {
            try {
                updateStatus('labevent', 'connecting');
                log('üîÑ Connecting to Lab Event Hub...', 'info');
                
                labEventConnection = new signalR.HubConnectionBuilder()
                    .withUrl(`${apiUrl}/hubs/lab-events`)
                    .configureLogging(signalR.LogLevel.Debug)
                    .build();
                
                labEventConnection.on('NewLabEvent', (data) => {
                    log(`üéØ New Lab Event: ${JSON.stringify(data)}`, 'event');
                });
                
                labEventConnection.onclose((error) => {
                    updateStatus('labevent', 'disconnected');
                    log('‚ùå Lab Event Hub disconnected: ' + (error || 'No error'), 'error');
                });
                
                await labEventConnection.start();
                updateStatus('labevent', 'connected');
                log('‚úÖ Lab Event Hub connected successfully!', 'success');
            } catch (error) {
                updateStatus('labevent', 'disconnected');
                log('‚ùå Lab Event Hub connection failed: ' + error.message, 'error');
            }
        }
        
        async function disconnectLabEvent() {
            if (labEventConnection) {
                await labEventConnection.stop();
                updateStatus('labevent', 'disconnected');
                log('üîå Lab Event Hub disconnected', 'info');
            }
        }
        
        async function joinAllEvents() {
            if (!labEventConnection || labEventConnection.state !== 'Connected') {
                log('‚ö†Ô∏è Lab Event Hub not connected', 'warning');
                return;
            }
            
            try {
                await labEventConnection.invoke('JoinAllEventsGroup');
                log('‚úÖ Joined all events group', 'success');
            } catch (error) {
                log(`‚ùå Failed to join all events: ${error.message}`, 'error');
            }
        }
        
        async function subscribeToEvent() {
            if (!labEventConnection || labEventConnection.state !== 'Connected') {
                log('‚ö†Ô∏è Lab Event Hub not connected', 'warning');
                return;
            }
            
            const eventId = parseInt(document.getElementById('labevent-event-id').value);
            try {
                await labEventConnection.invoke('SubscribeToEvent', eventId);
                log(`‚úÖ Subscribed to event: ${eventId}`, 'success');
            } catch (error) {
                log(`‚ùå Failed to subscribe to event: ${error.message}`, 'error');
            }
        }
        
        // ============ NOTIFICATION HUB ============
        async function connectNotification() {
            try {
                updateStatus('notification', 'connecting');
                log('üîÑ Connecting to Notification Hub...', 'info');
                
                notificationConnection = new signalR.HubConnectionBuilder()
                    .withUrl(`${apiUrl}/hubs/notifications`)
                    .configureLogging(signalR.LogLevel.Debug)
                    .build();
                
                notificationConnection.on('ReceiveNotification', (data) => {
                    log(`üîî Notification: ${JSON.stringify(data)}`, 'event');
                });
                
                notificationConnection.onclose((error) => {
                    updateStatus('notification', 'disconnected');
                    log('‚ùå Notification Hub disconnected: ' + (error || 'No error'), 'error');
                });
                
                await notificationConnection.start();
                updateStatus('notification', 'connected');
                log('‚úÖ Notification Hub connected successfully!', 'success');
            } catch (error) {
                updateStatus('notification', 'disconnected');
                log('‚ùå Notification Hub connection failed: ' + error.message, 'error');
            }
        }
        
        async function disconnectNotification() {
            if (notificationConnection) {
                await notificationConnection.stop();
                updateStatus('notification', 'disconnected');
                log('üîå Notification Hub disconnected', 'info');
            }
        }
        
        async function joinUserGroup() {
            if (!notificationConnection || notificationConnection.state !== 'Connected') {
                log('‚ö†Ô∏è Notification Hub not connected', 'warning');
                return;
            }
            
            const userId = parseInt(document.getElementById('notification-user-id').value);
            try {
                await notificationConnection.invoke('JoinUserGroup', userId);
                log(`‚úÖ Joined user group: ${userId}`, 'success');
            } catch (error) {
                log(`‚ùå Failed to join user group: ${error.message}`, 'error');
            }
        }
        
        async function joinRoleGroup() {
            if (!notificationConnection || notificationConnection.state !== 'Connected') {
                log('‚ö†Ô∏è Notification Hub not connected', 'warning');
                return;
            }
            
            const role = document.getElementById('notification-role').value;
            try {
                await notificationConnection.invoke('JoinRoleGroup', role);
                log(`‚úÖ Joined role group: ${role}`, 'success');
            } catch (error) {
                log(`‚ùå Failed to join role group: ${error.message}`, 'error');
            }
        }
        
        // ============ TEST ALL HUBS ============
        async function testAllHubs() {
            log('üß™ Starting automated test for all hubs...', 'info');
            
            // Test Booking Hub
            await connectBooking();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await joinBookingManager();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Test Equipment Hub
            await connectEquipment();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await joinAllManagers();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Test Security Hub
            await connectSecurity();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await joinSecurityTeam();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Test Lab Event Hub
            await connectLabEvent();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await joinAllEvents();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Test Notification Hub
            await connectNotification();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await joinUserGroup();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            log('‚úÖ All hubs tested successfully!', 'success');
        }
        
        // Initial log
        log('üöÄ SignalR Testing Dashboard loaded. API URL: ' + apiUrl, 'info');
    </script>
</body>
</html>
